parameters:
  - name: managed
    displayName: Use managed pool
    type: boolean
    default: true

trigger:
  - master

variables:
  npm_config_cache: $(Pipeline.Workspace)/.npm

jobs:
  - job: UnitTests
    timeoutInMinutes: 10
    cancelTimeoutInMinutes: 1
    pool:
      ${{ if eq(parameters.managed, true) }}:
        vmImage: 'ubuntu-latest'
      ${{ if eq(parameters.managed, false) }}:
        name: Default
    steps:
    - template: ./_unit-tests.yml

  - job: e2eTests
    dependsOn: 'UnitTests'
    timeoutInMinutes: 10
    cancelTimeoutInMinutes: 1
    pool:
      ${{ if eq(parameters.managed, true) }}:
        vmImage: 'ubuntu-latest'
      ${{ if eq(parameters.managed, false) }}:
        name: Default
    steps:
    - template: ./_e2e-tests.yml

  - job: Build
    dependsOn: [ 'UnitTests', 'e2eTests' ]
    timeoutInMinutes: 10
    cancelTimeoutInMinutes: 1
    pool:
      ${{ if eq(parameters.managed, true) }}:
        vmImage: 'ubuntu-latest'
      ${{ if eq(parameters.managed, false) }}:
        name: Default
    steps:
      - template: ./_build.yml
