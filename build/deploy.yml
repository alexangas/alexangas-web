resources:
  pipelines:
  - pipeline: alexangasweb
    source: alexangas.alexangas-web-ci
    trigger: 
      branches:
      - master

jobs:
  - job: DeployTwo
    pool:
      vmImage: 'windows-latest'
    condition: succeededOrFailed()
    steps:
      - template: ./_pwsh.yml
        parameters:
          options: 'sync "$(System.ArtifactsDirectory)\drop" "https://azcopyplay.blob.core.windows.net/`$web/?sv=2019-10-10&ss=b&srt=sco&sp=rwdlac&se=2021-04-30T23:13:25Z&st=2020-04-30T15:13:25Z&spr=https&sig=%2Bfnsun00qTpHEQ0GNYzUXUF8Mul2rji37WGrizK8hQc%3D" --recursive --delete-destination=true'
  - job: DeployTwoLinux
    pool:
      vmImage: 'ubuntu-latest'
    dependsOn: DeployTwo
    condition: succeededOrFailed()
    steps:
      - template: ./_pwsh.yml
        parameters:
          options: 'sync "$(System.ArtifactsDirectory)/drop" "https://azcopyplay.blob.core.windows.net/`$web/?sv=2019-10-10&ss=b&srt=sco&sp=rwdlac&se=2021-04-30T23:13:25Z&st=2020-04-30T15:13:25Z&spr=https&sig=%2Bfnsun00qTpHEQ0GNYzUXUF8Mul2rji37WGrizK8hQc%3D" --recursive --delete-destination=true'
  - job: DeployCli
    pool:
      vmImage: 'windows-latest'
    dependsOn: DeployTwoLinux
    condition: succeededOrFailed()
    steps:
      - task: AzureCLI@2
        inputs:
          azureSubscription: 'OBS-Discount-VSPremiumWithMSDN (7dd30468-7921-4c8d-975c-8920b8701ce3)'
          scriptType: 'pscore'
          scriptLocation: 'inlineScript'
          inlineScript: 'azcopy sync --help'
          powerShellErrorActionPreference: 'continue'
