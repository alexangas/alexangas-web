resources:
  pipelines:
  - pipeline: alexangasweb
    source: alexangas.alexangas-web-ci
    trigger: 
      branches:
      - master

jobs:
  - job: Deploy
    timeoutInMinutes: 10
    cancelTimeoutInMinutes: 0
    pool:
      vmImage: 'ubuntu-latest'
    steps:
      - task: DownloadBuildArtifacts@0
        displayName: "Download build artifacts"
        inputs:
          buildType: 'specific'
          project: '$(ProjectId)'
          pipeline: '$(ProjectDefinition)'
          specificBuildWithTriggering: true
          buildVersionToDownload: 'latestFromBranch'
          branchName: 'refs/heads/master'
          downloadType: 'single'
          artifactName: 'drop'
          downloadPath: '$(System.ArtifactsDirectory)/drop'
      - task: AzureCLI@2
        displayName: "Sync to storage account"
        inputs:
          azureSubscription: '$(Subscription)'
          scriptType: 'pscore'
          scriptLocation: 'inlineScript'
          inlineScript: 'az storage blob sync'
          arguments: '--source "drop" --container "$web" --account-name "$(Storage)" --account-key "$(AccountKey)"'
          failOnStandardError: true
