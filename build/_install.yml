parameters:
  - name: cache
    type: boolean
    default: true

steps:
  - task: CmdLine@2
    displayName: 'Set environment variables'
    inputs:
      script: 'export CI=true'

  - task: NodeTool@0
    displayName: 'Install Node.js'
    inputs:
      versionSpec: '12.x'

  - ${{ if eq(parameters.cache, true) }}:
    - task: Cache@2
      displayName: Cache npm
      inputs:
        key: 'npm | "$(Agent.OS)" | package-lock.json'
        restoreKeys: |
          npm | "$(Agent.OS)"
        path: $(npm_config_cache)

  - script: npm ci
    displayName: 'npm ci'
